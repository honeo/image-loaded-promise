function awaitImageLoaded(e,t=/.?/){if(!(e instanceof HTMLElement))throw new TypeError(`Invalid arguments[0]: ${e}`);if(!(t instanceof RegExp))throw new TypeError(`Invalid arguments[1]: ${t}`);return"IMG"===e.tagName?imgLoaded(e,t):backgroundImageLoaded(e,t)}async function imgLoaded(e,t){if(e.src&&t.test(e.src)||await watchAttributeP(e,"src",e=>t.test(e)),e.complete){if(!(!e.naturalWidth||!e.naturalHeight))return e;throw new Error(`load failed: ${e.src}`)}return new Promise((t,a)=>{e.addEventListener("load",a=>{t(e)},{once:!0}),e.addEventListener("error",e=>{a(e)},{once:!0})})}async function backgroundImageLoaded(e,t){let a=getBackgroundImageURL(window.getComputedStyle(e)["background-image"])||"";if(!a||!t.test(a)){const{value:n}=await watchAttributeP(e,"style",({backgroundImage:e})=>{const n=getBackgroundImageURL(e);return n&&t.test(a)&&n});a=n}const n=document.createElement("img");return new Promise((t,r)=>{n.addEventListener("load",a=>{t(e)},{once:!0}),n.addEventListener("error",e=>{r(e)},{once:!0}),n.src=a})}function hasBackgroundImageValue(e){return"string"==typeof e&&!!e&&"none"!==e}function getBackgroundImageURL(e){if(!hasBackgroundImageValue(e))return null;const t=e.match(/^(url\(")(.+)("\))$/);return t&&t[2]}function watchAttribute(e,t,a,n){new MutationObserver(([e],t)=>{const r=e.target,o=r[e.attributeName],i=a.call(r,o);i&&(t.disconnect(),n.call(r,i))}).observe(e,{attributes:!0,attributeFilter:[t]})}function watchAttributeP(e,t,a){return new Promise((n,r)=>{watchAttribute(e,t,a,a=>{n({target:e,name:t,value:a})})})}export default awaitImageLoaded;